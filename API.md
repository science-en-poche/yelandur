Yelandur API
============

Current version of the API is v1.

Yelandur serves its API from `domain.com/api/vX` where `X` is the current API
version. Anything above that (e.g. `domain.com/api` or `domain.com/`) returns
a `404` error. Therefore you must prepend `/api/vX` to all your API calls.
This will be shown in the first few examples below.


Version 1
---------

The API uses JSON as base format, and tries to follow the guidelines set down
by the [Ember.js REST
Adapter](http://emberjs.com/guides/models/the-rest-adapter/), i.e.:

* A dedicated top-level endpoint for each resource
* All data is encapsulated in a root object
* Any relationships to other objects are reflected as references to the `id`s
  of the linked objects
* Some resources can be transferred (in one direction or the other)
  individually or in arrays (always encapsulated in their root), and linked
  objects can be sideloaded (but only in the server -> client direction)

All this should become clearer in the examples below.


### Auth

All requests that modify data (`POST`, `PUT`, `DELETE`) require
authentication. All requests that involve experiment results or somehow
private data also require authentication.

For now only users can be authenticated (that is, researchers accessing data
generated by their experiments), but authenticating devices is in the works
(so that device users can retrieve their previously uploaded results).

Authentication is done thanks to [BrowserID /
Persona](https://login.persona.org/). The callback given to the `BrowserID`
protocol is `/auth/browserid/login` (i.e. `/api/v1/auth/browserid/login`) ; if
authentication is successful, a session cookie is set.

When testing manually, you can authenticate using
[Naja](https://github.com/wehlutyk/naja) (the Ajax frontend) and then make
your API requests directly in-browser.

`GET /auth/browserid/logout` (so `/api/v1/auth/browserid/logout` really)
clears the session cookie, i.e. logs the user out.


### Users

Users are identified by their login name. Being authenticated will give you
access to requests that modify data, and show you additional private data in
results.

#### `/users/<id>`

##### `GET`

`GET /users/<id>` (so `/api/v1/users/<id>`) gets public information
about the user identified by `id`. If you are authenticated as being that
user, private information (e.g. email address) is included.

So `GET /users/jane` returns

```json
{
    "user": {
        "id": "jane",
        "login_is_set": "true",
        "gravatar_id": "9e26471d35a78862c17e467d87cddedf"
    }
}
```

if you're not authenticated or if you're authenticated as someone else than
`jane` (note the root object encapsulation, mentioned in the guidelines
above).

If you're authenticated as `jane`, you'll get additional private
information (here, only the email attached to the user's Persona (i.e.
BrowserID)):

```json
{
    "user": {
        "id": "jane",
        "login_is_set": "true",
        "gravatar_id": "9e26471d35a78862c17e467d87cddedf",
        "persona_email": "jane@example.com"
    }
}
```

Adding an `sl_exps=true` argument to the URL will sideload all the user's
experiments. Adding an `sl_limit=<number>` argument will limit the number of
sideloaded experiments to the `number` most active (that argument is ignored
if `sl_exps=true` is not provided), ordered by decreasing activity.

So `GET /users/jane?sl_exps=true&sl_limit=3` will return

```json
{
    "user": {
        "id": "jane",
        "login_is_set": "true",
        "gravatar_id": "9e26471d35a78862c17e467d87cddedf"
    },
    "exps": [
        {
            "id": "3991cd52745e05f96baff356d82ce3fca48ee0f640422477676da645142c6153",
            "name": "numerical-distance",
            "description": "The famous numerical distance task, reproduced",
            "owner_id": "jane",
            "collaborator_ids": ["bether", "esda"],
            "n_results": 24854
        },
        {
            "id": "3e95168bbb013872e4c576d5f79190e14af523e3f94af2cf46a803c3680ffb14",
            "name": "after-motion-effect",
            "description": "After motion effects explored with smartphones",
            "owner_id": "jane",
            "collaborator_ids": ["bether", "will"],
            "n_results": 5176
        },
        {
            "id": "0fcc7f45421c84194a087dca5ffa2a820d41f8cf5371ac704b50886ec43e876f",
            "name": "gender-priming",
            "description": "Controversial gender-priming effects",
            "owner_id": "jane",
            "collaborator_ids": ["sophia", "nick"],
            "n_results": 3866
        }
    ]
}
```

if you're not authenticated as `jane`. If you are, the `user` object will
incorporate Jane's `persona_email` as it did above (but the experiment objects
won't change).


##### `PUT`

##### `DELETE`

#### `/users/me`

##### `GET`

#### `/users`

##### `GET`

### Devices

#### `/devices/<id>`

##### `GET`

##### `PUT`

##### `DELETE`

#### `/devices`

##### `GET`

##### `POST`

### Exps

#### `/exps/<id>`

##### `GET`

##### `PUT`

##### `DELETE`

#### `/exps`

##### `GET`

##### `POST`

### Results

#### `/results/<id>`

##### `GET`

#### `/results`

##### `GET`

##### `POST`
